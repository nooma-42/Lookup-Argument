# Benchmark System Enhancement: Incremental CSV Writing & Failure Tracking

## æ¦‚è¿°

æˆ‘å€‘å·²ç¶“æˆåŠŸç‚º Lookup Argument Benchmark ç³»çµ±æ·»åŠ äº†ä»¥ä¸‹é‡è¦åŠŸèƒ½ï¼š

1. **å³æ™‚ CSV å¯«å…¥** - æ¯å€‹ benchmark å®Œæˆå¾Œç«‹å³å¯«å…¥çµæœ
2. **å¤±æ•—è¿½è¹¤** - è¨˜éŒ„å¤±æ•—çš„ benchmark è©³ç´°è³‡è¨Š
3. **ç½é›£æ¢å¾©** - å³ä½¿ç¨‹åºä¸­æ–·ä¹Ÿèƒ½ä¿ç•™éƒ¨åˆ†çµæœ
4. **è©³ç´°å ±å‘Š** - åˆ†åˆ¥é¡¯ç¤ºæˆåŠŸå’Œå¤±æ•—çš„çµ±è¨ˆè³‡æ–™

## ğŸ¯ è§£æ±ºçš„å•é¡Œ

### åŸå§‹å•é¡Œï¼š
- æ‰€æœ‰çµæœåªåœ¨æœ€å¾Œæ‰å¯«å…¥ï¼Œå¦‚æœç¨‹åºåœ¨ä¸­é€”å¤±æ•—æœƒå¤±å»æ‰€æœ‰é€²åº¦
- ç„¡æ³•å¾—çŸ¥å…·é«”å“ªäº›é…ç½®å¤±æ•—
- é•·æ™‚é–“é‹è¡Œçš„ benchmark æ²’æœ‰ä¸­é–“æª¢æŸ¥é»

### è§£æ±ºæ–¹æ¡ˆï¼š
- âœ… **å³æ™‚å¯«å…¥**ï¼šæ¯å€‹ benchmark å®Œæˆå¾Œç«‹å³å¯«å…¥ CSV
- âœ… **å¤±æ•—æ—¥èªŒ**ï¼šå–®ç¨è¿½è¹¤å’Œè¨˜éŒ„å¤±æ•—çš„æ¡ˆä¾‹
- âœ… **é€²åº¦ä¿å­˜**ï¼šä¸­æ–·å¾Œå¯ä»¥æŸ¥çœ‹å·²å®Œæˆçš„çµæœ
- âœ… **è©³ç´°å ±å‘Š**ï¼šæ¸…æ¥šé¡¯ç¤ºæˆåŠŸ/å¤±æ•—çµ±è¨ˆ

## ğŸ”§ å¯¦ä½œç´°ç¯€

### æ–°å¢çš„çµæ§‹é«”

```rust
// è¿½è¹¤ benchmark åŸ·è¡Œçµæœï¼ˆæˆåŠŸæˆ–å¤±æ•—ï¼‰
enum BenchmarkOutcome {
    Success(BenchmarkResult),
    Failure(BenchmarkFailure),
}

// å¤±æ•—è³‡è¨Šè¨˜éŒ„
struct BenchmarkFailure {
    system: System,
    k_value: usize,
    n_to_n_ratio: usize,
    error_message: String,
    timestamp: SystemTime,
}

// åŸ·è¡Œç·’å®‰å…¨çš„ CSV å¯«å…¥å™¨
struct CsvWriter {
    file: Arc<Mutex<BufWriter<File>>>,
    header_written: Arc<Mutex<bool>>,
}

// å¤±æ•—è¿½è¹¤å™¨
struct FailureTracker {
    file: Arc<Mutex<BufWriter<File>>>,
    header_written: Arc<Mutex<bool>>,
}
```

### é—œéµåŠŸèƒ½

1. **å³æ™‚ CSV å¯«å…¥**
   - æ¯å€‹ benchmark å®Œæˆå¾Œç«‹å³å¯«å…¥ `benchmark_results.csv`
   - ä½¿ç”¨ç·©è¡å¯«å…¥å™¨æé«˜æ€§èƒ½
   - åŸ·è¡Œç·’å®‰å…¨çš„ä¸¦ç™¼å¯«å…¥

2. **å¤±æ•—è¿½è¹¤**
   - æ•ç² panic å’ŒéŒ¯èª¤
   - è¨˜éŒ„åˆ° `benchmark_failures.csv`
   - åŒ…å«éŒ¯èª¤è¨Šæ¯å’Œæ™‚é–“æˆ³

3. **é€²åº¦ç›£æ§**
   - å¯¦æ™‚é¡¯ç¤ºå®Œæˆç™¾åˆ†æ¯”
   - åˆ†åˆ¥çµ±è¨ˆæˆåŠŸå’Œå¤±æ•—æ•¸é‡
   - è¦–è¦ºåŒ–é€²åº¦æŒ‡ç¤ºå™¨

## ğŸ“ è¼¸å‡ºæª”æ¡ˆ

### benchmark_results.csv
```csv
System,K,N_to_n_Ratio,SetupTime_ms,ProveTime_ms,VerifyTime_ms,TotalTime_ms,ProofSize_bytes,Timestamp
Caulk,8,2,1575,228,4,1807,928,1752627002
CQ,8,2,1234,567,3,1804,512,1752627003
...
```

### benchmark_failures.csv
```csv
System,K,N_to_n_Ratio,ErrorMessage,Timestamp
Plookup,15,32,"Memory allocation failed",1752627004
...
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºæœ¬ç”¨æ³•
```bash
cargo bench --bench proof_system -- --system caulk --k 5..10 --ratio 2,4,8
```

### ä½¿ç”¨ç¤ºç¯„è…³æœ¬
```bash
./run_benchmark_with_csv.sh
```

### æª¢æŸ¥çµæœ
```bash
# æŸ¥çœ‹æˆåŠŸçš„çµæœ
cat benchmark_results.csv

# æŸ¥çœ‹å¤±æ•—çš„è¨˜éŒ„ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
cat benchmark_failures.csv

# çµ±è¨ˆè³‡è¨Š
wc -l benchmark_*.csv
```

## ğŸ’¡ ä¸»è¦å„ªå‹¢

### 1. ç½é›£æ¢å¾©
- **å•é¡Œ**ï¼šé•·æ™‚é–“é‹è¡Œçš„ benchmark å¦‚æœåœ¨æœ€å¾Œéšæ®µå¤±æ•—ï¼Œæœƒå¤±å»æ‰€æœ‰çµæœ
- **è§£æ±º**ï¼šæ¯å€‹ benchmark å®Œæˆå¾Œç«‹å³ä¿å­˜ï¼Œç¢ºä¿ä¸æœƒå¤±å»é€²åº¦

### 2. å¤±æ•—è¨ºæ–·
- **å•é¡Œ**ï¼šç„¡æ³•å¾—çŸ¥å“ªäº›ç‰¹å®šé…ç½®å¤±æ•—
- **è§£æ±º**ï¼šè©³ç´°è¨˜éŒ„æ¯å€‹å¤±æ•—æ¡ˆä¾‹çš„éŒ¯èª¤è¨Šæ¯å’Œåƒæ•¸

### 3. å³æ™‚ç›£æ§
- **å•é¡Œ**ï¼šé•·æ™‚é–“é‹è¡ŒæœŸé–“ç„¡æ³•æŸ¥çœ‹ä¸­é–“çµæœ
- **è§£æ±º**ï¼šå¯ä»¥éš¨æ™‚æŸ¥çœ‹ CSV æª”æ¡ˆçœ‹åˆ°ç›®å‰é€²åº¦

### 4. ä¸¦è¡Œå®‰å…¨
- **å•é¡Œ**ï¼šä¸¦è¡ŒåŸ·è¡Œæ™‚çš„æª”æ¡ˆå¯«å…¥è¡çª
- **è§£æ±º**ï¼šä½¿ç”¨åŸ·è¡Œç·’å®‰å…¨çš„å¯«å…¥å™¨ï¼Œé¿å…è³‡æ–™æå£

## ğŸ“Š ç¯„ä¾‹è¼¸å‡º

```
ğŸš€ Starting benchmark suite with 12 tasks
ğŸ“Š Systems: Caulk, CQ, Plookup
ğŸ”§ K values: [8, 9, 10]
âš–ï¸  N:n ratios: [2, 4, 8, 16]
============================================================
ğŸ’¾ Incremental CSV writing enabled:
   ğŸ“Š Results: benchmark_results.csv
   âŒ Failures: benchmark_failures.csv

ğŸ”„ [  1/ 12] Starting: Caulk (k=8, ratio=2)
âœ… [  1/ 12] Completed: Caulk (k=8, ratio=2) - 8.3% done
ğŸ”„ [  2/ 12] Starting: CQ (k=8, ratio=4)
âŒ [  2/ 12] Failed: CQ (k=8, ratio=4) - 16.7% done - Error: Memory allocation failed
...

ğŸ‰ Benchmark suite completed!
ğŸ“Š Summary: 10 successful, 2 failed, 12 total
============================================================

ğŸ“ Files created:
   ğŸ“Š benchmark_results.csv - 10 successful results
   âŒ benchmark_failures.csv - 2 failures
```

## ğŸ› ï¸ æŠ€è¡“å¯¦ä½œè¦é»

### åŸ·è¡Œç·’å®‰å…¨
- ä½¿ç”¨ `Arc<Mutex<>>` ä¿è­·å…±äº«è³‡æº
- é¿å…æª”æ¡ˆå¯«å…¥ç«¶çˆ­æ¢ä»¶
- ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§

### éŒ¯èª¤è™•ç†
- ä½¿ç”¨ `std::panic::catch_unwind` æ•ç² panic
- å„ªé›…åœ°è™•ç†æª”æ¡ˆ I/O éŒ¯èª¤
- æä¾›è©³ç´°çš„éŒ¯èª¤è¨Šæ¯

### æ€§èƒ½å„ªåŒ–
- ä½¿ç”¨ `BufWriter` æ¸›å°‘ç³»çµ±èª¿ç”¨
- ç«‹å³ flush ç¢ºä¿è³‡æ–™å®‰å…¨
- æœ€å°åŒ–é–å®šæ™‚é–“

## ğŸ”® æœªä¾†æ”¹é€²å»ºè­°

1. **æ–·é»çºŒå‚³**ï¼šæ”¯æ´å¾å¤±æ•—é»é‡æ–°é–‹å§‹
2. **é…ç½®æª”æ¡ˆ**ï¼šæ”¯æ´è‡ªå®šç¾©è¼¸å‡ºæª”æ¡ˆåç¨±
3. **é€²åº¦æ¢å¾©**ï¼šè®€å–ç¾æœ‰æª”æ¡ˆè·³éå·²å®Œæˆçš„ä»»å‹™
4. **çµ±è¨ˆåˆ†æ**ï¼šè‡ªå‹•ç”Ÿæˆæ€§èƒ½åˆ†æå ±å‘Š
5. **é€šçŸ¥ç³»çµ±**ï¼šå®Œæˆå¾Œç™¼é€é›»å­éƒµä»¶æˆ– Slack é€šçŸ¥

## ğŸ“‹ æ¸¬è©¦çµæœ

å·²æˆåŠŸæ¸¬è©¦çš„å ´æ™¯ï¼š
- âœ… å–®ä¸€ benchmark åŸ·è¡Œ
- âœ… å¤šç³»çµ±ä¸¦è¡ŒåŸ·è¡Œ  
- âœ… å¤§ç¯„åœåƒæ•¸æ¸¬è©¦
- âœ… æª”æ¡ˆæ¬Šé™å’Œ I/O éŒ¯èª¤è™•ç†
- âœ… ä¸­æ–·æ¢å¾©åŠŸèƒ½

## ğŸ“ çµè«–

é€™æ¬¡æ”¹é€²å¤§å¹…æå‡äº† benchmark ç³»çµ±çš„ç©©å®šæ€§å’Œå¯¦ç”¨æ€§ï¼š

1. **æ›´å¯é **ï¼šä¸æœƒå› ç‚ºå–®é»å¤±æ•—å¤±å»æ‰€æœ‰çµæœ
2. **æ›´é€æ˜**ï¼šæ¸…æ¥šé¡¯ç¤ºå“ªäº›é…ç½®æˆåŠŸ/å¤±æ•—
3. **æ›´å¯¦ç”¨**ï¼šæä¾›æ©Ÿå™¨å¯è®€çš„çµæœæ ¼å¼
4. **æ›´é«˜æ•ˆ**ï¼šä¸¦è¡ŒåŸ·è¡Œå¤§å¹…ç¸®çŸ­ç¸½æ™‚é–“

ç¾åœ¨ä½ å¯ä»¥å®‰å¿ƒé‹è¡Œé•·æ™‚é–“çš„ benchmarkï¼Œå³ä½¿é‡åˆ°å•é¡Œä¹Ÿæœ‰å®Œæ•´çš„è¨˜éŒ„å’Œéƒ¨åˆ†çµæœå¯ä¾›åˆ†æï¼ 